---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { roadmaps, getRoadmapById } from '../../data/roadmaps';

export async function getStaticPaths() {
  return roadmaps.map(roadmap => ({
    params: { id: roadmap.id },
  }));
}

const { id } = Astro.params;
const roadmap = getRoadmapById(id);

if (!roadmap) {
  return Astro.redirect('/roadmaps/');
}

// Get related roadmaps (same category, exclude current)
const relatedRoadmaps = roadmaps
  .filter(r => r.category === roadmap.category && r.id !== roadmap.id)
  .slice(0, 3);
---

<BaseLayout
  title={roadmap.title}
  description={roadmap.description}
  keywords={roadmap.tags.join(', ')}
>
  <div class="roadmap-detail-page">
    <!-- Hero Section -->
    <section class="roadmap-hero">
      <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
          <a href="/" class="breadcrumb-link">Home</a>
          <span class="breadcrumb-separator">/</span>
          <a href="/roadmaps/" class="breadcrumb-link">Roadmaps</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">{roadmap.title}</span>
        </nav>

        <div class="hero-content">
          <div class="hero-header">
            <div class="hero-icon">{roadmap.icon}</div>
            <div class="hero-badges">
              {roadmap.popular && <span class="badge-fire">üî• Popular</span>}
              {roadmap.new && <span class="badge-new">‚ú® NEW</span>}
            </div>
          </div>

          <h1 class="hero-title">
            <span class="code-bracket">&lt;</span>
            {roadmap.title}
            <span class="code-bracket">/&gt;</span>
          </h1>

          <p class="hero-description">
            <span class="comment">// </span>{roadmap.description}
          </p>

          <!-- Meta Info Cards -->
          <div class="meta-cards">
            <div class="meta-card glass-card">
              <div class="meta-label">Category</div>
              <div class="meta-value">{roadmap.category}</div>
            </div>
            {roadmap.subcategory && (
              <div class="meta-card glass-card">
                <div class="meta-label">Path</div>
                <div class="meta-value">{roadmap.subcategory}</div>
              </div>
            )}
            <div class="meta-card glass-card">
              <div class="meta-label">Difficulty</div>
              <div class={`meta-value difficulty-${roadmap.difficulty.toLowerCase()}`}>
                {roadmap.difficulty}
              </div>
            </div>
            <div class="meta-card glass-card">
              <div class="meta-label">Duration</div>
              <div class="meta-value">{roadmap.estimatedMonths} months</div>
            </div>
            {roadmap.salary && (
              <div class="meta-card glass-card">
                <div class="meta-label">Salary Range</div>
                <div class="meta-value salary">{roadmap.salary}</div>
              </div>
            )}
          </div>

          <!-- Tags -->
          <div class="tags-section">
            <span class="tags-label">Skills & Technologies:</span>
            <div class="tags-list">
              {roadmap.tags.map(tag => (
                <span class="tag">{tag}</span>
              ))}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Prerequisites & Learning Path -->
    {(roadmap.prerequisites || roadmap.learningPath) && (
      <section class="info-section">
        <div class="container">
          <div class="info-grid">
            {roadmap.prerequisites && (
              <div class="info-card glass-card">
                <h3 class="info-title">
                  <span class="title-icon">‚úÖ</span>
                  Prerequisites
                </h3>
                <ul class="info-list">
                  {roadmap.prerequisites.map(prereq => (
                    <li>{prereq}</li>
                  ))}
                </ul>
              </div>
            )}

            {roadmap.learningPath && (
              <div class="info-card glass-card">
                <h3 class="info-title">
                  <span class="title-icon">üõ§Ô∏è</span>
                  Learning Path
                </h3>
                <ul class="learning-path-list">
                  {roadmap.learningPath.map((step, index) => (
                    <li>
                      <span class="step-number">{index + 1}</span>
                      {step}
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        </div>
      </section>
    )}

    <!-- Interactive Roadmap Embed -->
    <section class="roadmap-embed-section">
      <div class="container">
        <div class="embed-header">
          <h2 class="embed-title">
            <span class="terminal-prompt">$</span>
            Interactive Roadmap
          </h2>
          <p class="embed-description">
            Click on nodes to explore topics. Use scroll to zoom in/out.
          </p>
        </div>

        <div class="embed-container glass-card">
          <div class="terminal-header">
            <div class="terminal-buttons">
              <span class="btn-close"></span>
              <span class="btn-minimize"></span>
              <span class="btn-maximize"></span>
            </div>
            <span class="terminal-title">{roadmap.id}.roadmap</span>
          </div>

          <div class="embed-wrapper">
            <iframe
              src={`https://roadmap.sh/r/embed?id=${roadmap.roadmapShId}`}
              width="100%"
              height="600px"
              frameBorder="0"
              title={`${roadmap.title} Roadmap`}
              loading="lazy"
            ></iframe>
          </div>
        </div>

        <div class="embed-footer">
          <p class="embed-note">
            <span class="note-icon">‚ÑπÔ∏è</span>
            This interactive roadmap is powered by <a href="https://roadmap.sh" target="_blank" rel="noopener">roadmap.sh</a>
          </p>
        </div>
      </div>
    </section>

    <!-- Related Roadmaps -->
    {relatedRoadmaps.length > 0 && (
      <section class="related-section">
        <div class="container">
          <h2 class="related-title">
            Related <span class="gradient-text">Roadmaps</span>
          </h2>

          <div class="related-grid">
            {relatedRoadmaps.map(related => (
              <a href={`/roadmaps/${related.id}/`} class="related-card glass-card">
                <div class="related-icon">{related.icon}</div>
                <h3 class="related-card-title">{related.title}</h3>
                <p class="related-description">{related.description}</p>
                <div class="related-meta">
                  <span class={`difficulty difficulty-${related.difficulty.toLowerCase()}`}>
                    {related.difficulty}
                  </span>
                  <span class="duration">{related.estimatedMonths}mo</span>
                </div>
              </a>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- CTA Section -->
    <section class="cta-section">
      <div class="container">
        <div class="cta-card glass-card">
          <h2 class="cta-title">Ready to start your journey?</h2>
          <p class="cta-description">
            Explore more DevOps and Cloud roadmaps to accelerate your career
          </p>
          <a href="/roadmaps/" class="btn btn-primary btn-large">
            View All Roadmaps
          </a>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .roadmap-detail-page {
    min-height: 100vh;
  }

  /* Breadcrumb */
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    margin-bottom: var(--spacing-8);
    font-family: 'Courier New', monospace;
    font-size: var(--text-sm);
    padding-top: var(--spacing-8);
  }

  .breadcrumb-link {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .breadcrumb-link:hover {
    color: var(--color-primary-500);
  }

  .breadcrumb-separator {
    color: var(--color-text-subtle);
  }

  .breadcrumb-current {
    color: var(--color-text);
  }

  /* Hero Section */
  .roadmap-hero {
    padding: var(--spacing-12) 0 var(--spacing-16);
    background:
      linear-gradient(180deg, rgba(59, 130, 246, 0.05) 0%, transparent 100%),
      linear-gradient(90deg, rgba(59, 130, 246, 0.02) 1px, transparent 1px),
      linear-gradient(rgba(59, 130, 246, 0.02) 1px, transparent 1px);
    background-size: 100% 100%, 50px 50px, 50px 50px;
  }

  .hero-content {
    max-width: 900px;
    margin: 0 auto;
  }

  .hero-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--spacing-6);
  }

  .hero-icon {
    font-size: 5rem;
    line-height: 1;
  }

  .hero-badges {
    display: flex;
    gap: var(--spacing-3);
  }

  .badge-fire, .badge-new {
    padding: var(--spacing-2) var(--spacing-4);
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 700;
  }

  .badge-fire {
    background: var(--gradient-orange);
    color: white;
  }

  .badge-new {
    background: var(--gradient-purple);
    color: white;
  }

  .hero-title {
    font-size: var(--text-6xl);
    font-weight: 900;
    margin-bottom: var(--spacing-4);
    line-height: 1.1;
  }

  .code-bracket {
    color: var(--color-text-subtle);
  }

  .hero-description {
    font-size: var(--text-xl);
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-8);
    font-family: 'Courier New', monospace;
  }

  .comment {
    color: var(--color-text-subtle);
  }

  /* Meta Cards */
  .meta-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--spacing-4);
    margin-bottom: var(--spacing-8);
  }

  .meta-card {
    padding: var(--spacing-4);
    text-align: center;
  }

  .meta-label {
    font-size: var(--text-xs);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-text-subtle);
    margin-bottom: var(--spacing-2);
    font-family: 'Courier New', monospace;
  }

  .meta-value {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-text);
  }

  .meta-value.salary {
    color: var(--color-accent-green);
  }

  .difficulty-beginner {
    color: var(--color-accent-green);
  }

  .difficulty-intermediate {
    color: var(--color-primary-500);
  }

  .difficulty-advanced {
    color: var(--color-accent-orange);
  }

  /* Tags */
  .tags-section {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--spacing-3);
  }

  .tags-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text-muted);
    font-family: 'Courier New', monospace;
  }

  .tags-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-2);
  }

  .tag {
    padding: var(--spacing-1) var(--spacing-3);
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    color: var(--color-primary-500);
    font-family: 'Courier New', monospace;
  }

  /* Info Section */
  .info-section {
    padding: var(--spacing-12) 0;
    background: var(--color-bg-secondary);
    border-top: 1px solid var(--color-bg-tertiary);
  }

  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: var(--spacing-8);
  }

  .info-card {
    padding: var(--spacing-8);
  }

  .info-title {
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    font-size: var(--text-2xl);
    margin-bottom: var(--spacing-6);
    color: var(--color-text);
  }

  .title-icon {
    font-size: 1.5rem;
  }

  .info-list, .learning-path-list {
    list-style: none;
    padding: 0;
  }

  .info-list li {
    padding: var(--spacing-3) 0;
    border-bottom: 1px solid var(--color-bg-tertiary);
    color: var(--color-text-muted);
  }

  .info-list li:last-child {
    border-bottom: none;
  }

  .learning-path-list li {
    display: flex;
    align-items: start;
    gap: var(--spacing-3);
    padding: var(--spacing-3) 0;
    color: var(--color-text-muted);
  }

  .step-number {
    flex-shrink: 0;
    width: 28px;
    height: 28px;
    background: var(--gradient-card);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--text-sm);
    font-weight: 700;
    color: white;
  }

  /* Roadmap Embed */
  .roadmap-embed-section {
    padding: var(--spacing-20) 0;
  }

  .embed-header {
    text-align: center;
    margin-bottom: var(--spacing-8);
  }

  .embed-title {
    font-size: var(--text-4xl);
    font-weight: 900;
    margin-bottom: var(--spacing-3);
    font-family: 'Courier New', monospace;
  }

  .terminal-prompt {
    color: var(--color-accent-green);
    margin-right: var(--spacing-2);
  }

  .embed-description {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
  }

  .embed-container {
    overflow: hidden;
    background: rgba(10, 14, 26, 0.9);
    border: 1px solid rgba(59, 130, 246, 0.3);
  }

  .terminal-header {
    background: rgba(20, 24, 41, 0.9);
    padding: var(--spacing-3) var(--spacing-4);
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    border-bottom: 1px solid rgba(59, 130, 246, 0.2);
  }

  .terminal-buttons {
    display: flex;
    gap: var(--spacing-2);
  }

  .terminal-buttons span {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: block;
  }

  .btn-close { background: #ff5f57; }
  .btn-minimize { background: #ffbd2e; }
  .btn-maximize { background: #28c840; }

  .terminal-title {
    font-family: 'Courier New', monospace;
    font-size: var(--text-xs);
    color: var(--color-text-muted);
    flex: 1;
    text-align: center;
  }

  .embed-wrapper {
    background: #0a0e1a;
  }

  .embed-wrapper iframe {
    display: block;
    width: 100%;
  }

  .embed-footer {
    text-align: center;
    margin-top: var(--spacing-6);
  }

  .embed-note {
    font-size: var(--text-sm);
    color: var(--color-text-subtle);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-2);
  }

  .note-icon {
    font-size: 1rem;
  }

  .embed-note a {
    color: var(--color-primary-500);
    text-decoration: underline;
  }

  /* Related Roadmaps */
  .related-section {
    padding: var(--spacing-16) 0;
    background: var(--color-bg-secondary);
    border-top: 1px solid var(--color-bg-tertiary);
  }

  .related-title {
    font-size: var(--text-4xl);
    font-weight: 900;
    text-align: center;
    margin-bottom: var(--spacing-12);
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--spacing-6);
  }

  .related-card {
    padding: var(--spacing-6);
    text-decoration: none;
    display: flex;
    flex-direction: column;
    transition: all var(--transition-base);
  }

  .related-card:hover {
    transform: translateY(-8px);
    border-color: var(--color-primary-500);
  }

  .related-icon {
    font-size: 3rem;
    margin-bottom: var(--spacing-4);
  }

  .related-card-title {
    font-size: var(--text-xl);
    font-weight: 700;
    margin-bottom: var(--spacing-3);
    color: var(--color-text);
  }

  .related-description {
    font-size: var(--text-base);
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-4);
    flex-grow: 1;
  }

  .related-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .difficulty {
    padding: var(--spacing-1) var(--spacing-2);
    border-radius: var(--radius-md);
    font-size: var(--text-xs);
    font-weight: 700;
    text-transform: uppercase;
  }

  .duration {
    font-family: 'Courier New', monospace;
    font-size: var(--text-xs);
    color: var(--color-text-subtle);
  }

  /* CTA Section */
  .cta-section {
    padding: var(--spacing-16) 0;
  }

  .cta-card {
    padding: var(--spacing-12);
    text-align: center;
    max-width: 700px;
    margin: 0 auto;
  }

  .cta-title {
    font-size: var(--text-4xl);
    font-weight: 900;
    margin-bottom: var(--spacing-4);
    color: var(--color-text);
  }

  .cta-description {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    margin-bottom: var(--spacing-8);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .hero-title {
      font-size: var(--text-4xl);
    }

    .hero-icon {
      font-size: 3.5rem;
    }

    .meta-cards {
      grid-template-columns: repeat(2, 1fr);
    }

    .info-grid {
      grid-template-columns: 1fr;
    }

    .embed-wrapper iframe {
      height: 500px;
    }

    .related-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
